<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>实时字幕</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    html, body {
      margin: 0;
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      color: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 16px;
      overflow: hidden;
    }
    
    .controls-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      padding: 8px 12px;
      background: #2a2a2a;
      border-bottom: 1px solid #3a3a3a;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      opacity: 0;
      transform: translateY(-100%);
      transition: all 0.3s ease;
      -webkit-app-region: drag;
    }
    
    .left-controls {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .right-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .controls-container.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .language-selector,
    .device-selector,
    .translation-toggle,
    .record-toggle,
    .language-selector select,
    .device-selector select,
    .translate-icon,
    .record-icon,
    .device-icon,
    .pin-btn,
    .close-btn {
      -webkit-app-region: no-drag;
      pointer-events: auto;
    }
    
    .language-selector, .device-selector, .translation-toggle, .record-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .language-selector {
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .language-selector.hidden {
      opacity: 0;
      visibility: hidden;
      display: none;
    }
    
    .language-selector label, .device-selector label {
      color: #ffffff;
      font-size: 16px;
      font-weight: 500;
    }
    
    .device-icon {
      width: 16px;
      height: 16px;
      fill: #ffffff;
      margin-right: 6px;
    }
    
    /* 窗口控制按钮样式 */
    .pin-btn,
    .close-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .pin-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }
    
    .pin-btn.pinned {
      background-color: rgba(0, 122, 255, 0.2);
    }
    
    .pin-btn.pinned .pin-icon {
      fill: #007aff;
    }
    
    .close-btn:hover {
      background-color: rgba(255, 59, 48, 0.8);
      transform: scale(1.1);
    }
    
    .pin-icon {
      width: 16px;
      height: 16px;
      fill: #6a6a6a;
      transition: all 0.3s ease;
    }
    
    .close-icon {
      width: 16px;
      height: 16px;
      fill: #6a6a6a;
      transition: all 0.3s ease;
    }
    
    .close-btn:hover .close-icon {
      fill: #ffffff;
    }
    
    .translation-toggle {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .translate-icon {
      width: 18px;
      height: 18px;
      fill: #ffffff;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
    }
    
    .record-icon {
      width: 18px;
      height: 18px;
      fill: #ffffff;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      margin-left: 8px;
    }
    
    .translate-icon:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }
    
    .record-icon:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }
    
    .record-icon.active {
      fill: #ff3b30;
      animation: record-pulse 2s ease-in-out infinite;
    }
    
    @keyframes record-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    .translate-icon.active {
      fill: #007aff;
    }
    
    .translate-icon.loading {
      fill: #ffd60a;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .translate-icon.loading {
      fill: #ffd60a;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .language-selector select, .device-selector select {
      font-size: 13px;
      padding: 4px 8px;
      background: #3a3a3a;
      border: 1px solid #4a4a4a;
      border-radius: 4px;
      color: #ffffff;
      outline: none;
    }
    
    .language-selector select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .language-selector select:focus, .device-selector select:focus {
      border-color: #007aff;
    }
    
    .language-selector select option, .device-selector select option {
      background: #3a3a3a;
      color: #ffffff;
    }
    
    #subtitles {
      padding: 80px 24px 24px 24px;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      text-align: center;
      box-sizing: border-box;
      position: relative;
    }
    
    .subtitles-container {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      transition: transform 0.8s ease-out;
    }
    
    .pair {
      margin-bottom: 24px;
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: opacity 0.8s ease-out;
    }
    
    .pair.old {
      opacity: 0.4;
    }
    
    .info, .translated {
      border-radius: 8px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans Arabic', sans-serif;
      width: 100%;
      box-sizing: border-box;
      line-height: 1.4;
    }
    
    .info {
      color: #ffffff;
      font-size: 18px;
      font-weight: 400;
      padding: 8px 20px 4px 20px;
      margin-bottom: 0;
    }
    
    .translated {
      color: #ffd60a;
      font-size: 16px;
      font-weight: 500;
      padding: 4px 20px 8px 20px;
      margin-bottom: 0;
    }
    
    .arabic {
      direction: rtl;
      text-align: right;
    }
    
    /* 启动日志样式 */
    .startup-mode {
      color: #00d4aa;
      font-family: 'SF Mono', 'Monaco', monospace;
      font-size: 14px;
      background: #2a2a2a;
      border-radius: 8px;
      padding: 16px;
      max-width: 600px;
    }
    
    .startup-mode .log-line {
      margin-bottom: 4px;
      opacity: 0.8;
    }
    
    .startup-mode .log-backend { color: #00d4aa; }
    .startup-mode .log-frontend { color: #007aff; }
    .startup-mode .log-audio { color: #ff9f0a; }
    .startup-mode .log-system { color: #ffffff; }
    
    .startup-mode .progress {
      margin-top: 12px;
      font-size: 16px;
      color: #ffffff;
      text-align: center;
      font-weight: 500;
    }
    
    /* 滚动条 */
    #subtitles::-webkit-scrollbar {
      width: 4px;
    }
    
    #subtitles::-webkit-scrollbar-thumb {
      background: #4a4a4a;
      border-radius: 2px;
    }
    
    /* 内容区域基础样式 */
    .content-area {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      padding-top: 50px; /* 为控制栏留出空间 */
      display: none;
    }
    
    /* 默认显示字幕模式 */
    #subtitles {
      display: block;
    }
    
    /* 记录模式时的显示切换 */
    body.record-mode #subtitles {
      display: none;
    }
    
    body.record-mode #record-content {
      display: block;
      overflow-y: auto;
      padding: 70px 20px 20px 20px; /* 为控制栏留出更多空间 */
      height: 100vh; /* 确保高度固定为视口高度 */
      box-sizing: border-box;
    }
    
    /* 记录项样式 - 优化为更紧凑的左对齐布局 */
    .record-item {
      padding: 8px 0;
      margin-bottom: 8px;
      border-bottom: 1px solid #333333;
      position: relative;
    }
    
    .record-item:last-child {
      border-bottom: none;
    }
    
    .record-item .record-meta {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-bottom: 4px;
      font-size: 11px;
      color: #888888;
      text-align: left;
    }
    
    .record-item .timestamp {
      color: #007aff;
      font-weight: 500;
      font-family: 'SF Mono', 'Monaco', monospace;
    }
    
    .record-item .original,
    .record-item .translation {
      line-height: 1.3;
      padding: 0;
      margin: 0;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
      text-align: left;
    }
    
    .record-item .original {
      color: #ffffff;
      font-size: 15px;
      font-weight: 400;
      margin-bottom: 2px;
    }
    
    .record-item .translation {
      color: #ffd60a;
      font-size: 13px;
      font-weight: 400;
      margin-bottom: 4px;
    }

    /* 悬浮录音控制面板样式 */
    .floating-record-panel {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(42, 42, 42, 0.95);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #3a3a3a;
      backdrop-filter: blur(10px);
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      z-index: 200;
      min-width: 120px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .floating-record-panel.active {
      display: flex;
    }
    
    .record-control-btn {
      width: 48px;
      height: 48px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      margin: 4px 0;
    }
    
    .record-btn {
      background: #ff3b30;
    }
    
    .record-btn:hover {
      background: #ff2d1a;
      transform: scale(1.1);
    }
    
    .stop-btn {
      background: #8e8e93;
    }
    
    .stop-btn:hover {
      background: #6d6d70;
      transform: scale(1.1);
    }
    
    .control-icon {
      width: 24px;
      height: 24px;
      fill: #ffffff;
    }
    
    .recording-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #ffffff;
      margin-top: 8px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #8e8e93;
      transition: all 0.3s ease;
    }
    
    .recording-status.recording .status-dot {
      background: #ff3b30;
      animation: recording-pulse 1.5s ease-in-out infinite;
    }
    
    .recording-status.stopped .status-dot {
      background: #34c759;
    }
    
    @keyframes recording-pulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.5;
        transform: scale(1.2);
      }
    }

    /* 响应式 */
    @media (max-width: 768px) {
      .controls-container {
        flex-direction: column;
        gap: 12px;
      }
      
      .info { font-size: 16px; }
      .translated { font-size: 14px; }
      
      .floating-record-panel {
        bottom: 80px;
        right: 10px;
        min-width: 100px;
      }
      
      .record-control-btn {
        width: 40px;
        height: 40px;
      }
      
      .control-icon {
        width: 20px;
        height: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="controls-container">
    <div class="left-controls">
      <div class="device-selector">
        <svg class="device-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
          <path d="M544 830.4V960h-64v-129.6c-161.6-16-288-152.8-288-318.4h64c0 140.8 115.2 256 256 256s256-115.2 256-256h64c0 165.6-126.4 302.4-288 318.4zM512 640c70.4 0 128-57.6 128-128V192c0-70.4-57.6-128-128-128s-128 57.6-128 128v320c0 70.4 57.6 128 128 128z" fill="#ffffff" />
        </svg>
        <select id="audio-device">
          <option value="">加载中...</option>
        </select>
      </div>
      <div class="translation-toggle">
        <svg class="translate-icon" id="translate-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M426.666667 921.6c-161.3824 0-295.253333-106.154667-319.863467-244.497067l34.7136 34.7136a17.134933 17.134933 0 0 0 24.1664 0 17.066667 17.066667 0 0 0 0-24.132266l-68.266667-68.266667a17.271467 17.271467 0 0 0-5.597866-3.720533c-1.194667-0.477867-2.423467-0.546133-3.6864-0.750934C87.210667 614.8096 86.3232 614.4 85.333333 614.4c-1.297067 0-2.4576 0.477867-3.652266 0.750933-0.9216 0.2048-1.911467 0.2048-2.798934 0.580267a17.885867 17.885867 0 0 0-5.700266 3.7888L5.0176 687.684267a17.066667 17.066667 0 0 0 24.132267 24.132266l41.8816-41.8816C92.16 830.634667 243.438933 955.733333 426.666667 955.733333a17.066667 17.066667 0 0 0 0-34.133333z m198.485333-1.194667a17.066667 17.066667 0 0 0 22.152533-9.5232L683.997867 819.2h168.0384l36.693333 91.682133a16.9984 16.9984 0 0 0 22.186667 9.5232 17.066667 17.066667 0 0 0 9.489066-22.186666l-136.533333-341.333334c-5.154133-12.970667-26.555733-12.970667-31.675733 0l-136.533334 341.333334a17.066667 17.066667 0 0 0 9.489067 22.186666z m142.848-311.227733L838.3488 785.066667h-140.731733l70.382933-175.889067zM631.466667 102.4c144.452267 0 264.260267 106.222933 286.208 244.6336l-35.293867-34.9184a17.066667 17.066667 0 1 0-23.995733 24.2688l66.7648 66.082133A16.827733 16.827733 0 0 0 938.666667 409.6l0.341333-0.068267 0.375467 0.068267c1.604267-0.170667 3.1744-0.648533 4.744533-1.092267 0.4096-0.136533 0.887467-0.136533 1.262933-0.3072a15.9744 15.9744 0 0 0 6.109867-3.720533l67.549867-68.266667a17.066667 17.066667 0 0 0-24.2688-23.995733l-41.540267 41.984C934.1952 193.4336 797.252267 68.266667 631.466667 68.266667a17.066667 17.066667 0 0 0 0 34.133333z m-204.8 68.266667H307.2V119.466667a17.066667 17.066667 0 0 0-34.133333 0V170.666667H153.6a17.066667 17.066667 0 0 0 0 34.133333h18.7392c8.6016 50.8928 52.565333 109.738667 94.4128 155.921067a875.861333 875.861333 0 0 1-55.944533 52.9408 17.066667 17.066667 0 0 0 22.1184 26.0096c2.6624-2.2528 27.2384-23.381333 57.207466-54.033067 29.969067 30.685867 54.5792 51.780267 57.207467 54.033067a17.066667 17.066667 0 1 0 22.1184-26.0096 848.554667 848.554667 0 0 1-55.944533-52.9408C355.362133 314.538667 399.325867 255.6928 407.927467 204.8h18.7392a17.066667 17.066667 0 0 0 0-34.133333z m-136.533334 165.0688C252.2112 293.614933 215.8592 244.394667 207.018667 204.8h166.1952C364.407467 244.394667 328.055467 293.614933 290.133333 335.735467zM1006.933333 477.866667H546.133333V17.066667a17.066667 17.066667 0 0 0-17.066666-17.066667H17.066667a17.066667 17.066667 0 0 0-17.066667 17.066667v512a17.066667 17.066667 0 0 0 17.066667 17.066666H477.866667v460.8a17.066667 17.066667 0 0 0 17.066666 17.066667h512a17.066667 17.066667 0 0 0 17.066667-17.066667v-512a17.066667 17.066667 0 0 0-17.066667-17.066666z m-529.066666 17.066666v17.066667H34.133333V34.133333h477.866667v443.733334h-17.066667a17.066667 17.066667 0 0 0-17.066666 17.066666zM989.866667 989.866667H512V512h477.866667v477.866667z" />
        </svg>
      </div>
      <div class="language-selector hidden">
        <select id="target-lang">
          <option value="en" selected>English</option>
          <option value="zh">中文</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
          <option value="fr">Français</option>
          <option value="de">Deutsch</option>
          <option value="es">Español</option>
          <option value="ru">Русский</option>
          <!-- <option value="ar">العربية</option> -->
          <option value="vi">Tiếng Việt</option>
          <option value="th">ไทย</option>
          <option value="id">Bahasa Indonesia</option>
          <option value="pt">Português</option>
          <option value="it">Italiano</option>
          <option value="hi">हिन्दी</option>
          <!-- <option value="yue">粤语 Cantonese</option> -->
        </select>
      </div>
      <div class="record-toggle">
        <svg class="record-icon" id="record-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M512 128c212.064 0 384 171.936 384 384s-171.936 384-384 384S128 724.064 128 512s171.936-384 384-384z m0 64c-176.736 0-320 143.264-320 320s143.264 320 320 320 320-143.264 320-320-143.264-320-320-320z m0 96c123.712 0 224 100.288 224 224s-100.288 224-224 224-224-100.288-224-224 100.288-224 224-224z" />
        </svg>
      </div>
    </div>
    
    <div class="right-controls">
      <!-- 固定窗口按钮 -->
      <button id="pin-btn" class="pin-btn" title="固定窗口为最前">
        <svg class="pin-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M755.2 51.2c19.2 0 38.4 12.8 44.8 25.6l25.6 51.2c6.4 12.8 0 25.6-12.8 32l-108.8 51.2 102.4 102.4c44.8 44.8 44.8 115.2 0 160l-57.6 57.6c-44.8 44.8-115.2 44.8-160 0L486.4 428.8l-25.6 108.8c-6.4 12.8-19.2 19.2-32 12.8l-51.2-25.6c-12.8-6.4-25.6-25.6-25.6-44.8V268.8c0-51.2 38.4-89.6 89.6-89.6h313.6z m-25.6 64H441.6c-19.2 0-25.6 6.4-25.6 25.6v185.6l19.2 44.8 108.8-25.6c12.8-6.4 25.6 0 32 12.8l108.8 108.8c19.2 19.2 44.8 19.2 64 0l57.6-57.6c19.2-19.2 19.2-44.8 0-64L697.6 236.8c-12.8-6.4-19.2-19.2-12.8-32l25.6-108.8 19.2-44.8z m-185.6 473.6l-320 320c-12.8 12.8-32 12.8-44.8 0s-12.8-32 0-44.8l320-320c12.8-12.8 32-12.8 44.8 0s12.8 32 0 44.8z" />
        </svg>
      </button>
      
      <!-- 关闭程序按钮 -->
      <button id="close-btn" class="close-btn" title="关闭程序">
        <svg class="close-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M563.8 512l262.5-312.9c4.4-5.2 0.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3.1-3.6-7.6-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3.1 3.6 7.6 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z" />
        </svg>
      </button>
    </div>
  </div>
  <div id="subtitles">
    <div class="subtitles-container"></div>
  </div>
  
  <!-- 记录模式内容 -->
  <div id="record-content" class="content-area">
    <!-- 记录项将在此动态添加 -->
  </div>
  
  <!-- 悬浮录音控制面板 -->
  <div id="floating-record-panel" class="floating-record-panel">
    <!-- 录音按钮 -->
    <button id="record-btn" class="record-control-btn record-btn">
      <svg class="control-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
        <path d="M544 830.4V960h-64v-129.6c-161.6-16-288-152.8-288-318.4h64c0 140.8 115.2 256 256 256s256-115.2 256-256h64c0 165.6-126.4 302.4-288 318.4zM512 640c70.4 0 128-57.6 128-128V192c0-70.4-57.6-128-128-128s-128 57.6-128 128v320c0 70.4 57.6 128 128 128z" />
      </svg>
    </button>
    
    <!-- 停止按钮 -->
    <button id="stop-btn" class="record-control-btn stop-btn" style="display: none;">
      <svg class="control-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
        <path d="M128 128h768v768H128V128z" />
      </svg>
    </button>
    
    <!-- 录音状态指示器 -->
    <div class="recording-status">
      <span class="status-dot"></span>
      <span class="status-text">待录音</span>
    </div>
  </div>
  
  <script src="renderer.js"></script>
</body>
</html>